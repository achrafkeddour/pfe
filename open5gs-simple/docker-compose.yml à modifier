version: "3.8"

services:
  nrf:
    build:
      context: .
      dockerfile: docker/Dockerfile.nrf
    container_name: open5gs-nrf
    network_mode: "host"
    volumes:
      - ./install:/open5gs
    healthcheck:
      test: ["CMD", "curl", "-f", "http://127.0.0.10:7777"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

  nssf:
    build:
      context: .
      dockerfile: docker/Dockerfile.nssf
    container_name: open5gs-nssf
    network_mode: "host"
    depends_on:
      nrf:
        condition: service_healthy
    volumes:
      - ./install:/open5gs
    healthcheck:
      test: ["CMD", "curl", "-f", "http://127.0.0.11:7777"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

  amf:
    build:
      context: .
      dockerfile: docker/Dockerfile.amf
    container_name: open5gs-amf
    network_mode: "host"
    depends_on:
      nrf:
        condition: service_healthy
      nssf:
        condition: service_healthy
    volumes:
      - ./install:/open5gs
    healthcheck:
      test: ["CMD", "curl", "-f", "http://127.0.0.5:7777"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

  ausf:
    build:
      context: .
      dockerfile: docker/Dockerfile.ausf
    container_name: open5gs-ausf
    network_mode: "host"
    depends_on:
      nrf:
        condition: service_healthy
    volumes:
      - ./install:/open5gs
    healthcheck:
      test: ["CMD", "curl", "-f", "http://127.0.0.12:7777"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

  udm:
    build:
      context: .
      dockerfile: docker/Dockerfile.udm
    container_name: open5gs-udm
    network_mode: "host"
    depends_on:
      nrf:
        condition: service_healthy
    volumes:
      - ./install:/open5gs
    healthcheck:
      test: ["CMD", "curl", "-f", "http://127.0.0.13:7777"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

  udr:
    build:
      context: .
      dockerfile: docker/Dockerfile.udr
    container_name: open5gs-udr
    network_mode: "host"
    depends_on:
      udm:
        condition: service_healthy
    volumes:
      - ./install:/open5gs
    healthcheck:
      test: ["CMD", "curl", "-f", "http://127.0.0.14:7777"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

  pcf:
    build:
      context: .
      dockerfile: docker/Dockerfile.pcf
    container_name: open5gs-pcf
    network_mode: "host"
    depends_on:
      nrf:
        condition: service_healthy
    volumes:
      - ./install:/open5gs
    healthcheck:
      test: ["CMD", "curl", "-f", "http://127.0.0.15:7777"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

  smf:
    build:
      context: .
      dockerfile: docker/Dockerfile.smf
    container_name: open5gs-smf
    network_mode: "host"
    depends_on:
      nrf:
        condition: service_healthy
      amf:
        condition: service_healthy
    volumes:
      - ./install:/open5gs
    healthcheck:
      test: ["CMD", "curl", "-f", "http://127.0.0.4:7777"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

  upf:
    build:
      context: .
      dockerfile: docker/Dockerfile.upf
    container_name: open5gs-upf
    network_mode: "host"
    depends_on:
      smf:
        condition: service_healthy
    volumes:
      - ./install:/open5gs
    healthcheck:
      test: ["CMD", "curl", "-f", "http://127.0.0.7:7777"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped